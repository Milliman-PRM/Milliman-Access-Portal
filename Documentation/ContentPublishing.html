<!DOCTYPE html>
<html>
<head>
    <title>Content Publishing - User Guide</title>
</head>
<body>
    <div class="accordion">
        <p>Creating a New Content Item</p>
        <span class="material-icons icon">expand_more</span>
    </div>
    <div class="content">
        <ol>
            <li>Select the client to which the content will be published in the <strong>Clients</strong> column on the left side of the screen.</li>
            <li>Click on the plus sign next to the search bar or click on the large <strong>Add Content Item</strong> button in the <strong>Content Items</strong> column.</li>
            <li>Fill out the Content Item form</li>
            <div>
                <ul>
                    <li>Field names designated with <strong>*</strong> are required fields</li>
                    <li>In the <strong>Files</strong> area of the form, click on a field for a prompt to upload a file</li>
                    <li>The following content types support publication of documents in "reducible" fashion.  If the content is intended to be reduced, do the following:
                        <ul>
                            <li>Set the <strong>Reducible</strong> toggle to the <strong>ON</strong> position (QlikView)</li>
                            <li>Check the <strong>Row Level Security</strong> check box (Power BI)</li>
                        </ul>
                    </li>
                    <li>After the content item is saved, <strong>the content type and Reducible status cannot be changed</strong></li>
                    <li>The <strong>Content Description</strong> field is for text that will appear on the Content Item card for all users with access to the content</li>
                    <li>The <strong>Custom Content Disclaimer</strong> field is the text that will be presented to end users and must be accepted before accessing the content; This field accepts markdown syntax for advanced styling</li>
                    <li>The <strong>Internal Notes</strong> field is for text that will only appear on the publishing page and can serve as notes for publishing users</li>
                </ul>
            </div>
            <li>Click <strong>Create Content Item</strong></li>
        </ol>
        <li>Processing of publications is performed in the order requested. Depending on the content type and complexity of the publication, this may take some time.</li>
        <li>The status of the request will be displayed below the content item card on this page</li>
        <h3 class="subheading">Approving a new or republished Content Item</h3>
        <ol>
            <li>After the Content Item has reached the <strong>Processed</strong> status, click the green checkmark on the Content Item card to review the processed publication</li>
            <li>Review and check off each section (if it is correct), and consider the attestation statement. Note that for the FileDownload content type, you can download the file to review it</li>
            <li>If something looks incorrect, click <strong>Reject</strong> to cancel the publication</li>
            <li>Click <strong>Approve</strong> at the bottom of the publication preview to make the content live</li>
            <li>Navigate to the <strong>Content Access Admin</strong> page to grant users access to the published content</li>
            <li>The new content will not be viewable by the end user until the publication has been approved and the user has been granted access to it</li>
        </ol>
    </div>
    <div class="accordion">
        <p>Publishing Containerized Apps</p>
        <span class="material-icons icon">expand_more</span>
    </div>
    <div class="content">
        <p>
            Publishing Containerized Apps follows the same general content publication workflow as any of the other content types available in MAP, but with some additional options and considerations unique to this content type.
            These can be broken down into two categories: <b>Container Settings</b> and <b>Container Lifetime</b>.
        </p>
        <p>
            To obtain pricing information for containers, please do the following:
            <ol>
                <li>Navigate to the <a href="https://azure.microsoft.com/en-us/pricing/calculator/" target="_blank">Azure Pricing Calculator</a></li>
                <li>Click on "Containers" in the left-hand column</li>
                <li>Click on "Azure Container Instances"</li>
                <li>Scroll down to the Azure Container Instances calculator form</li>
                <li>Set the region to "Central US"</li>
                <li>Set the operating system to "Linux"</li>
                <li>Set the number of container groups to the expected number of anticipated selection groups for the app</li>
                <li>Set the duration to the estimated time you expect the containerized application to be active during a month</li>
                <li>Set memory and vCPU to the expected values for your containerized application</li>
                <li>View the estimated monthly cost in the bottom-right corner of the form</li>
            </ol>
        </p>
        <h3 class="subheading">Container Settings</h3>
        <p>
            Container settings are where you have the ability to set options like number of vCPU's, amount of allocated RAM, and the port number exposed by the container that is being published.
            <p>
                <b>vCPU</b>: The number of cores allocated to the container. Increasing this number will increase the amount of processing power available, but will also increase the cost to run the container.
                This should be set based on the amount of processing done in the application as well as how many simultaneous users are expected.
            </p>
            <p>
                <b>RAM</b>: Indicates the amount of RAM allocated to the running container.  Increasing this number also increases the cost to run the container.
                This number should be set based on the specific memory needs of the container, along with expected utilization.
            </p>
            <p>
                <b>Internal Port</b>: Indicates the port that is exposed on the container for accessing the application within. This value is set in the Dockerfile/Containerfile that is used to define the container image.
                The internal port number can be found in the Dockerfile/Containerfile after the keyword <code>EXPOSE</code> followed by a number.  This number is the port that should be provided here.
            </p>
        </p>
        <h3 class="subheading">Container Lifetime</h3>
        <p>
            Container Lifetime pertains to the management of the active status of the container. These settings allow you to fine tune when a container is kept active while also allowing for the container to be kept in a "cold" or standby state.
            Since containers are only incurring cost while running, this allows you to better manage the associated cost of the container. If a user attempts to access a container app while it is in a cold state, they may need to wait several minutes for the container to start up.
            <p>
                <b>Container Cooldown Times</b>: This setting allows you to decide how long a container should remain active after the last interaction has happened outside of any custom scheduled active hours.
                This will allow users to come back within the set amount of time without the need to wait for a new container to start up.
            <p>
                <b>Customize Container Lifecycle</b>: This indicates whether the container should follow a custom "hot" schedule. Providing a custom schedule allows the container to be kept ready during business hours, while being kept in a standby state outside of those pre-defined hours.
                Turning this option on will expose the controls for setting the custom hot hours.
            </p>
            <p>
                <b>Custom Container Lifetime Schedule</b>: These settings are used to set days and times for containers to remain in an active state what will remove the need for users to wait for containers to start up before viewing and interacting with the container content.
                This schedule is configured by setting the start and end times, the time zone of the scheduled hours, and the days that the schedule should be applied to.
                Outside of these scheduled active hours, the container will be in a cold standby state that will require the user to wait for several minutes while the container is started.
            </p>
        </p>
        <h3 class="subheading">Bundling a Containerized App for Upload in MAP</h3>
        <p>
            Containerized Apps must be bundled appropriately in a format that MAP accepts. You can bundle your Container App as a TAR file or a gzipped TAR file (.tar.gz), and then upload it in the Content Publishing page like any other content.</p>
            <p>Bundling the application requires the use of <a href="https://docs.podman.io/">Podman</a>. Podman is a utility that serves as an open-source alternative to Docker, and can be used for building and running Containers in much the same way.</p>
            <p>To bundle your image for MAP, <a href="https://podman.io/getting-started/installation">ensure you have Podman installed on your machine</a>, and then complete the following steps:</p>
            <ol>
                <li>In the root of your project, where your project's Dockerfile/Containerfile lives, build your image with Podman using the following command: <code>podman build -t YourImageName .</code></li>
                <li>From a directory you'd like to store your bundled image, run the following command: <code>podman save -o YourImageName --format=docker-dir localhost/YourImageName</code></li>
                <li>
                    Then, create a TAR or gzipped TAR file of the new directory using your favorite archiving software, or by running the following commands:<br />
                    <code>cd YourImageName</code><br />
                    <code>tar cvf YourImageName.tar * # To create a .tar</code><br />
                    <code>tar cvfz YourImageName.tar.gz * # To create a .tar.gz</code><br />
                    We recommend bundling your application into a tar.gz for increased upload speeds when publishing to MAP.
                </li>
            </ol>
        </p>
        <h3 class="subheading">Websocket Considerations</h3>
        <p>
            <p>Applications with architectures that utilize <a href="https://developer.mozilla.org/en-US/docs/Web/API/WebSockets_API">websockets</a> (such as R Shiny or Blazor) as their primary method of communicating requests may require some additional considerations.</p>
            <p><b>Keeping the Containerized Application from Shutting Down</b></p>
            <p>For Containerized Apps with the <b>Always Cold</b> lifecycle option selected, applications which utilize websockets will spin down after the selected cooldown period <i>starting when the User opened the Content Item</i>. This is because MAP cannot keep track of messages coming across websockets, although we are working toward improving this in future releases so that the cooldown period begins when a User's session is completed.</p>
            <p>To remedy Containerized Apps shutting down while in use, we recommend the following:</p>
            <ul>
                <li>Increase the amount of cooldown time for the Content Item publication.</li>
                <li>Transition your Content Item to use a custom lifecycle method, and set appropriate hours for which the Content Item will always be kept alive regardless of User activity.</li>
                <li>Periodically close and reopen the application to ensure it does not shut down while in use. Reopening the application will ensure that a new connection has been established, which will reset the amount of time until MAP shuts it down back to the cooldown time amount.</li>
            </ul>
            <br />
            <p><b>Adding a Keep-Alive to Your Application</b></p>
            <p>Certain applications which utilize websockets will stop working after a certain period of inactivity due to the websocket timing out. The actual amount of time depends on the type of application.</p>
            <p>We recommend inserting code into your application which will periodically send a message across the websocket, regardless of any User activity in the application, in order to ensure the websocket stays alive.</p>
            <p>Please reach out to the <a href="emailto:map.support@milliman.com">MAP support team</a> to learn more.</p>
            <p>Note: This is different than the above issue, in which Applications are actually <b>stopped</b> and may take time to start back up. If your application stops working due to a websocket timeout, you should be able to refresh the page and get a fresh connection relatively quickly.</p>
        </p>
    </div>
    <div class="accordion">
        <p>Updating Existing Content</p>
        <span class="material-icons icon">expand_more</span>
    </div>
    <div class="content">
        <ol>
            <li>Select the client for which the content item has been published in the <strong>Clients</strong> column on the left side</li>
            <li>Select the content item to be updated</li>
            <li>Click on the blue Update icon on the content card, or click on the <strong>Update Content Item</strong> icon in the upper right corner</li>
            <li>Update the form on the right side of the screen as needed</li>
            <li>In the <strong>Files</strong> area of the form, click on a field for a prompt to upload an updated file</li>
            <li>Click <strong>Update Content Item</strong></li>
            <li>If a new content file, Thumbnail, User Guide, or Release Notes was included, the approval process outlined in the <strong>Content Publishing</strong> section above must be followed for the content to go live</li>
        </ol>
    </div>
    <div class="accordion">
        <p>Adding a Content Disclaimer</p>
        <span class="material-icons icon">expand_more</span>
    </div>
    <div class="content">
        <ol>
            <li>Select the client for which the content item has been published in the <strong>Clients</strong> column on the left side</li>
            <li>Select the content item that you would to add a disclaimer to</li>
            <li>Click on the blue Update icon on the content card, or click on the <strong>Update Content Item</strong> icon in the upper right corner</li>
            <li>Input the desired disclaimer text in the "Custom Disclaimer Text" input field</li>
            <li>If text formatting is desired, this can be accomplished through the use of <a href="https://www.markdownguide.org/basic-syntax/" target="_blank">markdown syntax</a></li>
            <li>To preview the formatted disclaimer text, click the "Preview" button above the "Custom Disclaimer Text" text box</li>
            <li>If desired, the content disclaimer can be made to appear every time a user accesses it by checking "Always Require Disclaimer Acceptance". By default, the disclaimer will be shown the first time a user accesses the content, and when the disclaimer is edited or the content is republished.</li>
            <li>Once you are satisfied with the disclaimer text and formatting, click the "CREATE CONTENT ITEM" or "UPDATE CONTENT ITEM" button</li>
        </ol>
    </div>
    <div class="accordion">
        <p>Deleting Content Items</p>
        <span class="material-icons icon">expand_more</span>
    </div>
    <div class="content">
        <ol>
            <li>Navigate to the Client, then the Content Item to be deleted</li>
            <li>Click on the red trash icon</li>
            <li>Press <strong>Delete</strong></li>
            <li>Press the <strong>Confirm Deletion</strong> to confirm the deletion</li>
        </ol>
    </div>
    <div class="accordion">
        <p>Downloading Editable Content</p>
        <span class="material-icons icon">expand_more</span>
    </div>
    <div class="content">
        <p>Content Publishers who have published Power BI Content Items marked as 'Editable' have the ability to download the current version of the document at any point.</p>
        <ul>
            <li>Select the client for which the content item has been published in the <strong>Clients</strong> column on the left side</li>
            <li>Click the <strong>Download Editable Power BI Content Item</strong> icon in the upper right corner</li>
        </ul>
    </div>
</body>
</html>
